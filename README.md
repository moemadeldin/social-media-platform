<p align="center"><b>Social Media Platform</b> — Laravel 11 API with Sanctum, Vite, and Tailwind</p>

---

## Overview

This repository contains a social media platform backend built with Laravel 11 (PHP 8.2) and Sanctum for API authentication. It provides endpoints for user registration and authentication (with email OTP verification), user profiles, posts with media, comments and replies, likes, following and follow-requests, stories, and notes. Frontend assets are powered by Vite and Tailwind CSS for any Blade-driven UI.

## Tech Stack

- PHP 8.2, Laravel 11
- Laravel Sanctum (token-based API auth)
- Vite 5, Tailwind CSS, PostCSS
- SQLite (default) — can be switched to MySQL/PostgreSQL via `.env`
- PHPUnit for tests, Laravel Pint for code style
- Queues for email/OTP delivery

## Project Structure (high level)

- `app/Http/Controllers` — API controllers for auth, posts, profiles, media, comments, likes, stories, notes
- `app/Models` — Eloquent models (User, Post, Comment, Reply, Like, Follower, Story, Note, Media, SavedPost, etc.)
- `app/Services` — domain services (Auth, Follow, Like, Profile, UserProfile, Token)
- `routes/api.php` and `routes/auth.php` — public and authenticated API routes
- `database/migrations` — schema for users, profiles, posts, media, comments, likes, followers, stories, notes
- `resources/` — Blade view(s), JS/CSS with Vite/Tailwind

## Requirements

- PHP >= 8.2
- Composer
- Node.js >= 18 (Node 20+ recommended) and npm
- SQLite (default) or another database of your choice

## Quick Start

1) Install PHP and JS dependencies:

```bash
composer install
npm install
```

2) Environment config:

- Copy `.env.example` to `.env` (if `.env.example` is missing, create `.env` and set the variables below).
- Generate app key and link storage:

```bash
php artisan key:generate
php artisan storage:link
```

3) Database:

- SQLite is supported out of the box. Ensure `database/database.sqlite` exists (it may already be present). If not, create it:

```bash
mkdir -p database
type NUL > database/database.sqlite  # Windows
# or: touch database/database.sqlite  # macOS/Linux
```

- Run migrations:

```bash
php artisan migrate
```

4) Start the app:

- Option A (convenient dev runner with server, queue, logs, and Vite):

```bash
composer run dev
```

- Option B (run services separately):

```bash
php artisan serve
php artisan queue:listen --tries=1
npm run dev
```

5) Open the app:

- API base URL: `http://127.0.0.1:8000`
- Example public endpoints: `GET /api/{username}`, `GET /api/{username}/posts`

## Environment Variables

Minimum useful settings in `.env`:

- `APP_NAME=SocialMedia`
- `APP_ENV=local`
- `APP_KEY=...` (generated by `php artisan key:generate`)
- `APP_URL=http://127.0.0.1:8000`
- `DB_CONNECTION=sqlite` (or `mysql`/`pgsql` with corresponding host/user/pass)
- `QUEUE_CONNECTION=database` (or `sync` for local quick start)
- Mail (for OTP/verification):
  - `MAIL_MAILER=smtp`
  - `MAIL_HOST=...`
  - `MAIL_PORT=...`
  - `MAIL_USERNAME=...`
  - `MAIL_PASSWORD=...`
  - `MAIL_ENCRYPTION=tls`
  - `MAIL_FROM_ADDRESS=...`
  - `MAIL_FROM_NAME="${APP_NAME}"`

## API Overview

Public (rate-limited):

- `POST /api/register` — register user
- `POST /api/login` — login
- `POST /api/forgot-password` — request password reset
- `GET /api/{username}` — view profile
- `GET /api/{username}/posts` — list user posts

Authenticated (Sanctum bearer token via `Authorization: Bearer <token>`):

- Auth: `POST /api/check-verification-code`, `POST /api/register/verification`, `POST /api/reset-password`, `POST /api/logout`
- Profile: `GET /api/accounts/{username}`, `PUT|POST|DELETE /api/accounts/edit`
- Follow: `POST /api/{username}/follow`, `DELETE /api/{username}/unfollow`
- Follow Requests: `GET /api/follow-requests`, `POST /api/follow-requests/{username}/accept|decline`
- Posts: `GET /api/posts/{user:username}`, `POST /api/posts`, `PUT|DELETE /api/posts/{user:username}/{post}`
- Media: `POST|DELETE /api/{username}/posts/{post}/media`
- Comments: `POST|PUT|DELETE /api/posts/{user:username}/{post}/comment[/ {comment}]`
- Replies: `POST|PUT|DELETE /api/posts/{user:username}/{post}/{comment}/replies[/ {reply}]`
- Likes: `POST /api/like/{model}/{id}`
- Stories: `GET|POST|PUT|DELETE /api/stories/{user:username}[/ {story}]`
- Notes: `GET|POST|PUT|DELETE /api/notes/{user:username}[/ {note}]`

Note: Some routes use route model binding and username scoping.

## Development Scripts

- `composer run dev` — concurrently runs server, queue listener, live logs, and Vite
- `npm run dev` — Vite dev server
- `npm run build` — production asset build

## Testing & Code Style

```bash
php artisan test     # or: ./vendor/bin/phpunit
```

Format with Pint:

```bash
./vendor/bin/pint
```

## Deployment Notes

1) Build assets and optimize config/cache:

```bash
npm run build
php artisan config:cache route:cache view:cache
```

2) Run migrations and queues on the server:

```bash
php artisan migrate --force
php artisan queue:work --daemon --tries=3
```

3) Point your process manager (e.g., Supervisor/systemd) to run `php artisan queue:work`.

## Troubleshooting

- 419/Unauthenticated: Ensure you are sending Bearer tokens for protected routes and that `SANCTUM` is configured. For SPA/CSRF flows use proper cookies and CORS.
- Emails not sending: Verify SMTP credentials and that the queue worker is running, or set `QUEUE_CONNECTION=sync` for local testing.
- SQLite errors: Confirm `database/database.sqlite` exists and that the PHP process has write permissions.
- Vite not serving assets: Ensure `npm run dev` is running during development, or `npm run build` for production.

## License

MIT
